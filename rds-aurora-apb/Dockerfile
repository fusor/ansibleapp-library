FROM ansibleapp/ansibleapp-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"aWQ6IDMzNGM2ZWU0LWVkNmEtNDUyMC05YzFiLWIwNjhkOGQ0YTdhNwpuYW1lOiByZHMtYXVyb3Jh\
LWFwYgppbWFnZTogYW5zaWJsZXBsYXlib29rYnVuZGxlL3Jkcy1hdXJvcmEtYXBiCmRlc2NyaXB0\
aW9uOiBNYW5hZ2VkIHJlbGF0aW9uYWwgZGF0YWJhc2Ugc2VydmljZSB3aXRoIGEgY2hvaWNlIG9m\
IHNpeCBwb3B1bGFyIGRhdGFiYXNlIGVuZ2luZXMuICBTZXQgdXAsIG9wZXJhdGUsIGFuZCBzY2Fs\
ZSBhIHJlbGF0aW9uYWwgZGF0YWJhc2UgaW4gdGhlIGNsb3VkIHdpdGgganVzdCBhIGZldyBjbGlj\
a3MuCnRhZ3M6CiAgLSBhbWF6b24KICAtIGRhdGFiYXNlCmJpbmRhYmxlOiB0cnVlCmFzeW5jOiBv\
cHRpb25hbApwYXJhbWV0ZXJzOiB7fQptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogIkFtYXpvbiBS\
RFMgLSBBdXJvcmEiCiAgbG9uZ0Rlc2NyaXB0aW9uOiAiQW1hem9uIFJlbGF0aW9uYWwgRGF0YWJh\
c2UgU2VydmljZSAoQW1hem9uIFJEUykgbWFrZXMgaXQgZWFzeSB0byBzZXQgdXAsIG9wZXJhdGUs\
IGFuZCBzY2FsZSBhIHJlbGF0aW9uYWwgZGF0YWJhc2UgaW4gdGhlIGNsb3VkLiBJdCBwcm92aWRl\
cyBjb3N0LWVmZmljaWVudCBhbmQgcmVzaXphYmxlIGNhcGFjaXR5IHdoaWxlIG1hbmFnaW5nIHRp\
bWUtY29uc3VtaW5nIGRhdGFiYXNlIGFkbWluaXN0cmF0aW9uIHRhc2tzLCBmcmVlaW5nIHlvdSB1\
cCB0byBmb2N1cyBvbiB5b3VyIGFwcGxpY2F0aW9ucyBhbmQgYnVzaW5lc3MuIEFtYXpvbiBSRFMg\
cHJvdmlkZXMgeW91IHNpeCBmYW1pbGlhciBkYXRhYmFzZSBlbmdpbmVzIHRvIGNob29zZSBmcm9t\
LCBpbmNsdWRpbmcgQW1hem9uIEF1cm9yYSwgUG9zdGdyZVNRTCwgTXlTUUwsIE1hcmlhREIsIE9y\
YWNsZSwgYW5kIE1pY3Jvc29mdCBTUUwgU2VydmVyLiIKICBpbWFnZVVybDogImh0dHBzOi8vczMu\
YW1hem9uYXdzLmNvbS9mdXNvci8yMDE3ZGVtby9EYXRhYmFzZV9BbWF6b25SRFMucG5nIgogIGRv\
Y3VtZW50YXRpb25Vcmw6ICJodHRwczovL2F3cy5hbWF6b24uY29tL3Jkcy8iCgo="
ADD ansible /opt/ansible
ADD ansibleapp /opt/ansibleapp

RUN useradd -u 1001 -r -g 0 -M -b /opt/ansibleapp -s /sbin/nologin -c "ansibleapp user" ansibleapp
RUN chown -R 1001:0 /opt/{ansible,ansibleapp}
USER 1001
